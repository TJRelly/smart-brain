{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = initHeadManager;\nexports.isEqualNode = isEqualNode;\nexports.DOMAttributeNames = void 0;\n\nfunction initHeadManager() {\n  return {\n    mountedInstances: new Set(),\n    updateHead: head => {\n      const tags = {};\n      head.forEach(h => {\n        if ( // If the font tag is loaded only on client navigation\n        // it won't be inlined. In this case revert to the original behavior\n        h.type === 'link' && h.props['data-optimized-fonts']) {\n          if (document.querySelector(`style[data-href=\"${h.props['data-href']}\"]`)) {\n            return;\n          } else {\n            h.props.href = h.props['data-href'];\n            h.props['data-href'] = undefined;\n          }\n        }\n\n        const components = tags[h.type] || [];\n        components.push(h);\n        tags[h.type] = components;\n      });\n      const titleComponent = tags.title ? tags.title[0] : null;\n      let title = '';\n\n      if (titleComponent) {\n        const {\n          children\n        } = titleComponent.props;\n        title = typeof children === 'string' ? children : Array.isArray(children) ? children.join('') : '';\n      }\n\n      if (title !== document.title) document.title = title;\n      ['meta', 'base', 'link', 'style', 'script'].forEach(type => {\n        updateElements(type, tags[type] || []);\n      });\n    }\n  };\n}\n\nconst DOMAttributeNames = {\n  acceptCharset: 'accept-charset',\n  className: 'class',\n  htmlFor: 'for',\n  httpEquiv: 'http-equiv',\n  noModule: 'noModule'\n};\nexports.DOMAttributeNames = DOMAttributeNames;\n\nfunction reactElementToDOM(_ref) {\n  let {\n    type,\n    props\n  } = _ref;\n  const el = document.createElement(type);\n\n  for (const p in props) {\n    if (!props.hasOwnProperty(p)) continue;\n    if (p === 'children' || p === 'dangerouslySetInnerHTML') continue; // we don't render undefined props to the DOM\n\n    if (props[p] === undefined) continue;\n    const attr = DOMAttributeNames[p] || p.toLowerCase();\n\n    if (type === 'script' && (attr === 'async' || attr === 'defer' || attr === 'noModule')) {\n      el[attr] = !!props[p];\n    } else {\n      el.setAttribute(attr, props[p]);\n    }\n  }\n\n  const {\n    children,\n    dangerouslySetInnerHTML\n  } = props;\n\n  if (dangerouslySetInnerHTML) {\n    el.innerHTML = dangerouslySetInnerHTML.__html || '';\n  } else if (children) {\n    el.textContent = typeof children === 'string' ? children : Array.isArray(children) ? children.join('') : '';\n  }\n\n  return el;\n}\n\nfunction isEqualNode(oldTag, newTag) {\n  if (oldTag instanceof HTMLElement && newTag instanceof HTMLElement) {\n    const nonce = newTag.getAttribute('nonce'); // Only strip the nonce if `oldTag` has had it stripped. An element's nonce attribute will not\n    // be stripped if there is no content security policy response header that includes a nonce.\n\n    if (nonce && !oldTag.getAttribute('nonce')) {\n      const cloneTag = newTag.cloneNode(true);\n      cloneTag.setAttribute('nonce', '');\n      cloneTag.nonce = nonce;\n      return nonce === oldTag.nonce && oldTag.isEqualNode(cloneTag);\n    }\n  }\n\n  return oldTag.isEqualNode(newTag);\n}\n\nfunction updateElements(type, components) {\n  const headEl = document.getElementsByTagName('head')[0];\n  const headCountEl = headEl.querySelector('meta[name=next-head-count]');\n\n  if (process.env.NODE_ENV !== 'production') {\n    if (!headCountEl) {\n      console.error('Warning: next-head-count is missing. https://nextjs.org/docs/messages/next-head-count-missing');\n      return;\n    }\n  }\n\n  const headCount = Number(headCountEl.content);\n  const oldTags = [];\n\n  for (let i = 0, j = headCountEl.previousElementSibling; i < headCount; i++, j = (j == null ? void 0 : j.previousElementSibling) || null) {\n    var ref;\n\n    if ((j == null ? void 0 : (ref = j.tagName) == null ? void 0 : ref.toLowerCase()) === type) {\n      oldTags.push(j);\n    }\n  }\n\n  const newTags = components.map(reactElementToDOM).filter(newTag => {\n    for (let k = 0, len = oldTags.length; k < len; k++) {\n      const oldTag = oldTags[k];\n\n      if (isEqualNode(oldTag, newTag)) {\n        oldTags.splice(k, 1);\n        return false;\n      }\n    }\n\n    return true;\n  });\n  oldTags.forEach(t => {\n    var ref;\n    return (ref = t.parentNode) == null ? void 0 : ref.removeChild(t);\n  });\n  newTags.forEach(t => headEl.insertBefore(t, headCountEl));\n  headCountEl.content = (headCount - oldTags.length + newTags.length).toString();\n}\n\nif ((typeof exports.default === 'function' || typeof exports.default === 'object' && exports.default !== null) && typeof exports.default.__esModule === 'undefined') {\n  Object.defineProperty(exports.default, '__esModule', {\n    value: true\n  });\n  Object.assign(exports.default, exports);\n  module.exports = exports.default;\n}","map":{"version":3,"mappings":"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","names":["initHeadManager","isEqualNode","mountedInstances","Set","updateHead","head","tags","forEach","h","type","props","document","querySelector","href","undefined","components","push","titleComponent","title","children","Array","isArray","join","updateElements","DOMAttributeNames","acceptCharset","className","htmlFor","httpEquiv","noModule","reactElementToDOM","el","createElement","p","hasOwnProperty","attr","toLowerCase","setAttribute","dangerouslySetInnerHTML","innerHTML","__html","textContent","oldTag","newTag","HTMLElement","nonce","getAttribute","cloneTag","cloneNode","headEl","getElementsByTagName","headCountEl","process","env","NODE_ENV","console","error","headCount","Number","content","oldTags","i","j","previousElementSibling","tagName","newTags","map","filter","k","len","length","splice","t","parentNode","removeChild","insertBefore","toString"],"sources":["../../../src/client/head-manager.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}